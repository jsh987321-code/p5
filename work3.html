<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>과제 3</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  </head>
  <body>
    <main>
      <h1>과제 3</h1>
    </main>

    <script>
      let hairHue = 0;
      let hairColor;
      let pupilOffsetX = 0;
      let pupilOffsetY = 0;

      let isBlinking = false;
      let blinkProgress = 1;
      let lastBlinkTime = 0;
      let blinkDuration = 400;

      function setup() {
        createCanvas(600, 400);
        angleMode(DEGREES);
        colorMode(HSB);
      }

      function draw() {
        colorMode(RGB);
        background(255, 255, 0);
        colorMode(HSB);

        // 머리카락 색 자동 변화
        hairHue = (millis() / 1500 * 360 / 7) % 360;
        hairColor = color(hairHue, 80, 70);

        // 눈동자 위치 (마우스 따라)
        let maxOffset = 5;
        pupilOffsetX = map(mouseX, 0, width, -maxOffset, maxOffset);
        pupilOffsetY = map(mouseY, 0, height, -maxOffset, maxOffset);

        // 깜빡임 상태 업데이트
        if (isBlinking) {
          let t = (millis() - lastBlinkTime) / blinkDuration;
          if (t < 0.5) {
            blinkProgress = 1 - sin(t * PI);
          } else if (t < 1) {
            blinkProgress = sin((t - 0.5) * PI);
          } else {
            isBlinking = false;
            blinkProgress = 1;
          }
        }

        // 색상 정의 (HSB)
        let faceColor = color(30, 20, 100);
        let eyebrowColor = color(0, 0, 10);
        let eyeBrownColor = color(30, 80, 50);
        let scleraColor = color(0, 0, 100);
        let noseColor = color(20, 30, 90);
        let mouthColor = color(0, 80, 60);
        let pinkClothColor = color(340, 40, 100);

        // 1. 머리카락
        noStroke();
        fill(hairColor);
        beginShape();
        vertex(width / 2 - 120, height / 2 - 120);
        bezierVertex(width / 2 - 180, height / 2 - 150,
                     width / 2 + 180, height / 2 - 150,
                     width / 2 + 120, height / 2 - 120);
        bezierVertex(width / 2 + 180, height / 2 + 0,
                     width / 2 + 180, height / 2 + 120,
                     width / 2 + 100, height / 2 + 180);
        bezierVertex(width / 2 + 50, height / 2 + 200,
                     width / 2 - 50, height / 2 + 200,
                     width / 2 - 100, height / 2 + 180);
        bezierVertex(width / 2 - 180, height / 2 + 120,
                     width / 2 - 180, height / 2 + 0,
                     width / 2 - 120, height / 2 - 120);
        endShape(CLOSE);

        // 2. 귀
        fill(faceColor);
        stroke(0);
        strokeWeight(1.5);
        ellipse(width / 2 - 110, height / 2, 30, 60);
        ellipse(width / 2 + 110, height / 2, 30, 60);

        // 3. 목
        noStroke();
        fill(faceColor);
        rect(width / 2 - 20, height / 2 + 110, 40, 50);

        // 4. 얼굴
        fill(faceColor);
        stroke(0);
        strokeWeight(2);
        ellipse(width / 2, height / 2, 200, 220);

        // 5. 앞머리
        noStroke();
        fill(hairColor);
        beginShape();
        vertex(width / 2 - 90, height / 2 - 80);
        bezierVertex(width / 2 - 70, height / 2 - 130,
                     width / 2 + 70, height / 2 - 130,
                     width / 2 + 90, height / 2 - 80);
        bezierVertex(width / 2 + 60, height / 2 - 50,
                     width / 2 - 60, height / 2 - 50,
                     width / 2 - 90, height / 2 - 80);
        endShape(CLOSE);

        // 6. 눈썹
        noFill();
        stroke(eyebrowColor);
        strokeWeight(3);
        arc(width / 2 - 40, height / 2 - 50, 40, 20, 180, 360);
        arc(width / 2 + 40, height / 2 - 50, 40, 20, 180, 360);

        // 7. 눈 (깜빡임)
        fill(scleraColor);
        stroke(0);
        strokeWeight(1);
        let eyeHeight = 30 * blinkProgress;
        ellipse(width / 2 - 40, height / 2 - 30, 40, eyeHeight);
        ellipse(width / 2 + 40, height / 2 - 30, 40, eyeHeight);

        if (eyeHeight > 5) {
          fill(eyeBrownColor);
          noStroke();
          ellipse(width / 2 - 40 + pupilOffsetX, height / 2 - 30 + pupilOffsetY, 15, 15);
          ellipse(width / 2 + 40 + pupilOffsetX, height / 2 - 30 + pupilOffsetY, 15, 15);

          fill(0);
          ellipse(width / 2 - 40 + pupilOffsetX, height / 2 - 30 + pupilOffsetY, 8, 8);
          ellipse(width / 2 + 40 + pupilOffsetX, height / 2 - 30 + pupilOffsetY, 8, 8);
        }

        // 8. 코
        fill(noseColor);
        noStroke();
        triangle(width / 2 - 10, height / 2 + 10,
                 width / 2 + 10, height / 2 + 10,
                 width / 2, height / 2 + 40);

        // 9. 입
        fill(mouthColor);
        stroke(0);
        strokeWeight(1);
        arc(width / 2, height / 2 + 70, 80, 40, 0, 180);

        // 10. 옷
        fill(pinkClothColor);
        stroke(0);
        strokeWeight(2);
        rect(width / 2 - 150, height / 2 + 150, 300, 100);
      }

      function keyPressed() {
        if (keyCode === UP_ARROW) {
          isBlinking = true;
          blinkProgress = 1;
          lastBlinkTime = millis();
        }
      }
    </script>
  </body>
</html>
